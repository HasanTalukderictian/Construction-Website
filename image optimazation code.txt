const optimizeImage = (file) => {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = (event) => {
      const img = new Image();
      img.src = event.target.result;

      img.onload = () => {
        const canvas = document.createElement("canvas");
        const MAX_WIDTH = 800;
        const scaleSize = MAX_WIDTH / img.width;
        canvas.width = MAX_WIDTH;
        canvas.height = img.height * scaleSize;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        canvas.toBlob(
          (blob) => {
            const optimizedFile = new File([blob], file.name, {
              type: "image/jpeg",
              lastModified: Date.now(),
            });
            resolve(optimizedFile);
          },
          "image/jpeg",
          0.7 // compression quality
        );
      };
    };
  });
};





const handleImageChange = async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const optimized = await optimizeImage(file);
  setImage(optimized);
};


<div className="mb-3">
  <label className="form-label">Picture</label>
  <input
    type="file"
    accept="image/*"
    className={`form-control ${errors.image ? "is-invalid" : ""}`}
    onChange={handleImageChange}
  />
  {errors.image && (
    <div className="invalid-feedback">{errors.image}</div>
  )}

  {image && (
    <div className="position-relative mt-3" style={{ maxWidth: "150px" }}>
      <img
        src={URL.createObjectURL(image)}
        alt="Preview"
        className="img-thumbnail"
      />
      <button
        type="button"
        className="btn btn-sm btn-danger position-absolute top-0 end-0"
        onClick={() => setImage(null)}
        style={{
          borderRadius: "50%",
          padding: "0 6px",
          transform: "translate(50%, -50%)",
        }}
      >
        &times;
      </button>
    </div>
  )}
</div>
