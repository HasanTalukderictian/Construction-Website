const optimizeImage = (file) => {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = (event) => {
      const img = new Image();
      img.src = event.target.result;

      img.onload = () => {
        const canvas = document.createElement("canvas");
        const MAX_WIDTH = 800;
        const scaleSize = MAX_WIDTH / img.width;
        canvas.width = MAX_WIDTH;
        canvas.height = img.height * scaleSize;

        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        canvas.toBlob(
          (blob) => {
            const optimizedFile = new File([blob], file.name, {
              type: "image/jpeg",
              lastModified: Date.now(),
            });
            resolve(optimizedFile);
          },
          "image/jpeg",
          0.7 // compression quality
        );
      };
    };
  });
};





const handleImageChange = async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const optimized = await optimizeImage(file);
  setImage(optimized);
};


<div className="mb-3">
  <label className="form-label">Picture</label>
  <input
    type="file"
    accept="image/*"
    className={`form-control ${errors.image ? "is-invalid" : ""}`}
    onChange={handleImageChange}
  />
  {errors.image && (
    <div className="invalid-feedback">{errors.image}</div>
  )}

  {image && (
    <div className="position-relative mt-3" style={{ maxWidth: "150px" }}>
      <img
        src={URL.createObjectURL(image)}
        alt="Preview"
        className="img-thumbnail"
      />
      <button
        type="button"
        className="btn btn-sm btn-danger position-absolute top-0 end-0"
        onClick={() => setImage(null)}
        style={{
          borderRadius: "50%",
          padding: "0 6px",
          transform: "translate(50%, -50%)",
        }}
      >
        &times;
      </button>
    </div>
  )}
</div>






















   public function update(Request $request, $id)
{
    // Find the employee by ID
    $employee = Employee::find($id);

    // Check if employee exists
    if (!$employee) {
        return response()->json([
            'success' => false,
            'message' => 'Employee not found.'
        ], 404);
    }

    // Validate the request data
    $request->validate([
        'employee_id'   => 'required|string|max:255|unique:employees,employee_id,' . $employee->id,
        'employee_name' => 'required|string|max:255',
        'status'         => 'required|in:Active,Deactive',
        'joining_date'   => 'required|string', // Ensure correct format
        'designation'    => 'required|string|max:255',
        'department'     => 'required|string|max:255',
        'contact_no'     => 'required|digits_between:10,11|unique:employees,contact_no,' . $employee->id,
        'image'         => 'nullable|image|mimes:jpeg,png,jpg,gif|max:2048',
    ]);

    // Update the employee fields
    $employee->employee_id   = $request->employee_id;
    $employee->employee_name = $request->employee_name;
    $employee->status         = $request->status;
    $employee->joining_date   = Carbon::createFromFormat('d-m-Y', $request->joining_date)->format('Y-m-d');
    $employee->designation    = $request->designation;
    $employee->department     = $request->department;
    $employee->contact_no     = $request->contact_no;

    // Handle image upload if present
    if ($request->hasFile('image')) {
        // Delete the old image if a new one is uploaded
        if ($employee->image && file_exists(public_path('storage/' . $employee->image))) {
            unlink(public_path('storage/' . $employee->image));
        }

        // Store the new image
        $imagePath = $request->file('image')->store('employees', 'public');
        $employee->image = $imagePath;
    }

    // Save the updated employee
    $employee->save();

    return response()->json([
        'success' => true,
        'message' => 'Employee updated successfully!',
        'data' => $employee
    ]);
}


